# 工作流名称，可自定义
name: Gradle Build and Upload Artifacts

# 触发条件：推送到main分支、创建PR时触发
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# 运行的作业
jobs:
  build:
    # 运行环境：选择Ubuntu最新版（也可以选windows-latest/macos-latest）
    runs-on: ubuntu-latest

    steps:
      # 步骤1：检出仓库代码（必须，否则无法访问项目文件）
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤2：设置JDK环境（Gradle需要JDK，根据你的项目选择版本，比如17、11）
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin' # 使用Eclipse Temurin JDK（推荐）
          cache: 'gradle' # 自动缓存Gradle依赖，加速后续构建

      # 步骤3：赋予gradlew可执行权限（Linux/macOS下必要，避免权限不足）
      - name: Make gradlew executable
        run: chmod +x ./gradlew

      # 步骤4：执行Gradle构建命令（根据你的项目需求修改，比如build、assembleRelease等）
      - name: Build with Gradle
        run: ./gradlew build --no-daemon # --no-daemon避免守护进程导致的问题

      # 步骤5：上传构建产物到Artifacts（核心步骤，用于下载结果）
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          # Artifact名称，可自定义，下载时会显示这个名称
          name: gradle-build-results
          # 构建产物的路径（关键！根据你的Gradle项目调整）
          # 常见路径：
          # - Java项目：build/libs/ (包含JAR包)
          # - Android项目：app/build/outputs/apk/release/ (APK包)
          # - 多模块项目：*/build/libs/
          path: |
            build/libs/
            # 可以添加多个路径，比如：
            # app/build/outputs/apk/release/
            # build/reports/ (构建报告)
          # 可选：保留空目录（默认false，如需保留可设为true）
          if-no-files-found: error # 没有找到文件时抛出错误，避免静默失败
